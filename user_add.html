<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>
    <link rel="icon" type="image/png" href="/IMAGE/Brandfavicon.png">
    <link rel="stylesheet" href="theme.css">

    <style>
        :root {
            --primary-color: #2980b9;
            --success-color: #27ae60;
            --danger-color: #c0392b;
            --secondary-color: #7f8c8d;
        }

        .form-container {
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            margin: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .form-field-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 0;
            flex-shrink: 0;
        }

        .button-group {
            display: flex;
            border: 1px solid #ccc;
            border-radius: 4px;
            overflow: hidden;
        }

        .button-group input[type="radio"] {
            display: none;
        }

        .btn-group-option {
            padding: 5px 15px;
            cursor: pointer;
            background-color: #fff;
            color: #555;
            transition: background-color 0.2s, color 0.2s;
            border-right: 1px solid #ccc;
            font-weight: normal;
        }

        .button-group .btn-group-option:last-of-type {
            border-right: none;
        }

        .button-group input[type="radio"]:checked+.btn-group-option {
            background-color: var(--primary-color, #007bff);
            color: white;
            border-color: var(--primary-color, #007bff);
        }

        .button-group input[type="radio"]:not(:checked)+.btn-group-option:hover {
            background-color: #e9ecef;
        }

        .input-with-counter {
            position: relative;
            display: flex;
        }

        .form-input {
            padding: 5px 10px;
            padding-right: 50px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            box-sizing: border-box;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
            background: #f7f7f7;
            width: 100%;
        }

        input#mobile-no.form-input,
        select.form-input {
            padding-right: 10px;
        }

        input#password.form-input {
            padding-right: 85px;
        }

        .w-40ch {
            width: 40ch;
        }

        .w-30ch {
            width: 30ch;
        }

        .w-20ch {
            width: 20ch;
        }

        .w-15ch {
            width: 15ch;
        }

        .form-input:focus {
            outline: none;
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.2);
        }

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
            appearance: none;
        }

        .mandatory-star {
            color: red;
            font-weight: bold;
        }

        .char-counter {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            font-size: 0.8em;
            color: #6c757d;
            pointer-events: none;
        }

        .password-toggle-icon {
            position: absolute;
            top: 50%;
            right: 55px;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 0 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
        }

        .password-toggle-icon svg {
            width: 16px;
            height: 16px;
        }

        .form-descriptions {
            margin: 15px 5px 5px 5px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .form-descriptions h3 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #333;
        }

        .form-descriptions ol {
            padding-left: 20px;
            margin: 0;
            font-size: 0.9em;
            color: #555;
        }

        .form-descriptions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .form-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .btn {
            padding: 10px 22px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            color: #ffffff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .btn svg {
            width: 20px;
            height: 20px;
        }

        .btn-danger {
            background-color: #c0392b;
        }

        .btn-danger:hover {
            background-color: #e74c3c;
        }

        .btn-success {
            background-color: #27ae60;
        }

        .btn-success:hover {
            background-color: #2ecc71;
        }

        .btn-secondary {
            background-color: #7f8c8d;
        }

        .btn-secondary:hover {
            background-color: #95a5a6;
        }

        /* ========================================= */
        /* == ✨ NEW MODAL DESIGN FROM IMAGE ✨    == */
        /* ========================================= */
        #th-status-modal .th-modal-content {
            background-color: #ffffff;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            padding: 0;
            max-width: 450px;
            overflow: hidden;
            /* Important for rounded corners on footer */
            text-align: center;
        }

        .th-modal-body {
            padding: 30px 25px;
        }

        #th-status-modal-message {
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 1.1rem;
            color: #555555;
            line-height: 1.6;
        }

        #th-status-modal-close {
            background-color: #007bff;
            /* Default button color */
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .th-modal-footer {
            padding: 12px;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        /* --- State Colors --- */
        #th-status-modal.success .th-modal-footer {
            background-color: #007bff;
            /* Blue for Success */
        }

        #th-status-modal.success #th-status-modal-close {
            background-color: #007bff;
            /* Blue button for Success */
        }

        #th-status-modal.success #th-status-modal-close:hover {
            background-color: #0056b3;
        }

        #th-status-modal.error .th-modal-footer {
            background-color: #dc3545;
            /* Red for Error */
        }

        #th-status-modal.error #th-status-modal-close {
            background-color: #dc3545;
            /* Red button for Error */
        }

        #th-status-modal.error #th-status-modal-close:hover {
            background-color: #c82333;
        }

        /* ========================================= */
        /* ========================================= */

        @media screen and (max-width: 1200px) {
            .form-group {
                align-items: flex-start;
                flex-direction: column;
            }

            .form-field-group {
                flex-direction: column;
                align-items: flex-start;
                width: 100%;
                gap: 5px;
            }

            .input-with-counter {
                width: 100%;
            }

            .w-40ch,
            .w-30ch,
            .w-20ch,
            .w-15ch {
                width: 100%;
            }

            .th-navbar-clock,
            #th-user-profile-name {
                display: none;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>

<body class="th-sidebar-is-closed">
    <script>
        // Instantly apply theme from localStorage
        (function () {
            try {
                const savedTheme = localStorage.getItem('userTheme');
                if (savedTheme) {
                    const theme = JSON.parse(savedTheme);
                    const root = document.documentElement;
                    root.style.setProperty('--primary-color', theme.THEME_NAVBARBG);
                    root.style.setProperty('--sidebar-bg', theme.THEME_SIDEBARBG);
                    root.style.setProperty('--secondary-color', theme.THEME_FOOTERBG);
                    root.style.setProperty('--module-dropdown-bg', theme.THEME_MODULEBG);
                    root.style.setProperty('--navbar-font-color', theme.THEME_NAVBARFONTCLR);
                    root.style.setProperty('--module-font-border-color', theme.THEME_CURRMODULEBGANDFONTCLR);
                    root.style.setProperty('--menu-type-font-color', theme.THEME_MTRSCLR);
                    root.style.setProperty('--menu-item-font-color', theme.THEME_CURRMODULEBGANDFONTCLR);
                    root.style.setProperty('--menu-hover-bg', theme.THEME_MENUSUBMENUBG);
                    root.style.setProperty('--menu-header-bg', theme.THEME_MENUHEADERBG);
                }
            } catch (e) {
                console.error('Failed to apply theme from localStorage:', e);
            }
        })();
    </script>

    <header class="th-top-navbar">
        <div class="th-navbar-left">
            <div class="th-sidebar-brand">
                <img src="/IMAGE/Brandlogo.png" alt="Brand Logo" class="th-brand-logo">
                <span>ZeroDrift</span><span class="th-brand-suffix">&nbsp;ERP</span>
            </div>
            <div class="th-navbar-interactive-area">
                <button class="th-hamburger-menu" id="th-hamburger-menu">☰</button>
                <div class="th-navbar-brand" id="th-company-brand-name">Loading...</div>
            </div>
        </div>
        <div class="th-navbar-right-items">
            <div class="th-favorite-icon" id="th-favorites-icon" title="Favorites">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                </svg>
            </div>
            <div class="th-navbar-clock">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span id="th-live-time"></span>
            </div>
            <div class="th-contact-directory-icon" id="th-contact-directory-icon" title="Contact Directory">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
                </svg>
            </div>
            <div class="th-notification-wrapper" id="th-notification-wrapper">
                <div class="th-notification-icon" title="Your Messages">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                    </svg>
                    <span class="th-notification-badge" id="th-notification-badge" style="display: none;"></span>
                </div>
                <div class="th-notification-panel" id="th-notification-panel">
                    <div class="th-notification-header">Your Message</div>
                    <div class="th-notification-filter-container" id="th-notification-filter-container">
                        <button class="th-notification-filter" data-filter="all">All</button>
                        <button class="th-notification-filter th-active" data-filter="unread">Unread</button>
                    </div>
                    <div class="th-notification-list" id="th-notification-list"></div>
                </div>
            </div>
            <div class="th-tools-container">
                <div class="th-tools-gear-icon" id="th-tools-gear-toggle" title="Tools">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-4.243-4.243l3.275-3.275a4.5 4.5 0 00-6.336 4.486c.046.58.023 1.193-.14 1.743m-2.132 2.132L5.586 5.586m12.828 12.828l-3.03-2.495" />
                    </svg>
                </div>
                <div class="th-tools-dropdown-menu" id="th-tools-dropdown-menu">
                    <a href="#" id="th-theme-change-option">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.95-4.243l-1.59-1.591M5.25 12H3m4.243-4.95l1.59-1.591M12 15a3 3 0 100-6 3 3 0 000 6z" />
                        </svg>
                        <span>Change Theme</span>
                    </a>
                </div>
            </div>
            <div class="th-user-profile-container">
                <div class="th-user-profile" id="th-user-profile-toggle">
                    <img src="/IMAGE/Usericon.png" alt="User PNG">
                    <span id="th-user-profile-name">Loading...</span>
                    <svg class="th-user-dropdown-arrow" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                    </svg>
                </div>
                <div class="th-user-dropdown-menu" id="th-user-dropdown-menu">
                    <div class="th-has-nested-dropdown">
                        <a class="th-nested-dropdown-toggle">
                            <span>Switch Company</span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3"
                                stroke="currentColor" style="width:16px; height:16px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                            </svg>
                        </a>
                        <div class="th-nested-dropdown-menu" id="th-company-list-container"></div>
                    </div>
                    <div class="th-dropdown-divider"></div>
                    <a href="#" id="th-change-password-link">Change Password</a>
                    <a href="#" id="th-logout-button">Logout</a>
                </div>
            </div>
        </div>
    </header>

    <aside class="th-sidebar" id="th-sidebar">
        <div class="th-module-selector">
            <img src="https://newdemo.nwayerp.org/mis_css/img/mis_icon/account_1.png" alt="Module Icon"
                class="th-module-icon" id="th-module-icon">
            <div class="th-module-wrapper">
                <button class="th-current-module" id="th-module-toggle">
                    <span id="th-current-module-name">Loading...</span>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                    </svg>
                </button>
                <div class="th-module-dropdown" id="th-module-dropdown"></div>
            </div>
        </div>
        <nav class="th-sidebar-nav">
            <ul id="th-sidebar-menu-list"></ul>
        </nav>
    </aside>

    <main class="th-main-content">
        <div class="th-page-header">
            <h1>Admin > Master > User > Add</h1><a href="user_list.html" class="th-header-action-link"><svg
                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                </svg> List</a>
        </div>

        <div class="form-container">
            <form id="addUserForm">
                <div class="form-group">
                    <label class="form-label">User Category</label>
                    <div class="button-group">
                        <input type="radio" id="user_cat_internal" name="user_category" value="Internal" checked>
                        <label for="user_cat_internal" class="btn-group-option">Internal</label>
                        <input type="radio" id="user_cat_external" name="user_category" value="External">
                        <label for="user_cat_external" class="btn-group-option">External</label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="form-field-group" id="employee-name-group">
                        <label class="form-label" for="employee-select">Employee Name <span
                                class="mandatory-star">*</span></label>
                        <div class="input-with-counter w-30ch">
                            <input list="employee-list" id="employee-select" name="employee" class="form-input"
                                placeholder="Type for search employee..." required>
                            <datalist id="employee-list"></datalist>
                        </div>
                    </div>
                    <div class="form-field-group">
                        <label class="form-label" for="user-name">User Name <span
                                class="mandatory-star">*</span></label>
                        <div class="input-with-counter w-30ch">
                            <input type="text" id="user-name" name="username" class="form-input" required
                                maxlength="30">
                            <span class="char-counter"></span>
                        </div>
                    </div>
                    <div class="form-field-group">
                        <label class="form-label" for="login-name">Login Name <span
                                class="mandatory-star">*</span></label>
                        <div class="input-with-counter w-30ch">
                            <input type="text" id="login-name" name="login_name" class="form-input" required
                                maxlength="30">
                            <span class="char-counter"></span>
                        </div>
                    </div>
                    <div class="form-field-group">
                        <label class="form-label" for="mobile-no">Mobile No.</label>
                        <input type="number" id="mobile-no" name="mobile_no" class="form-input w-15ch"
                            oninput="javascript: if (this.value.length > 10) this.value = this.value.slice(0, 10);">
                    </div>
                    <div class="form-field-group">
                        <label class="form-label" for="email-id">Email ID</label>
                        <div class="input-with-counter w-40ch">
                            <input type="email" id="email-id" name="email_id" class="form-input" maxlength="40">
                            <span class="char-counter"></span>
                        </div>
                    </div>
                    <div class="form-field-group">
                        <label class="form-label" for="password">Password <span class="mandatory-star">*</span></label>
                        <div class="input-with-counter w-30ch">
                            <input type="password" id="password" name="password" class="form-input" required
                                maxlength="20">
                            <button type="button" id="password-toggle" class="password-toggle-icon"
                                aria-label="Show password"></button>
                            <span class="char-counter"></span>
                        </div>
                    </div>
                    <div class="form-field-group">
                        <label class="form-label" for="user-type-select">User Type <span
                                class="mandatory-star">*</span></label>
                        <select id="user-type-select" name="user_type_dropdown" class="form-input w-15ch" required>
                            <option value="super">Super</option>
                            <option value="admin">Admin</option>
                            <option value="user" selected>User</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="reset" class="btn btn-danger">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12h-15" />
                        </svg> Clear
                    </button>
                    <button type="submit" class="btn btn-success">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg> Save
                    </button>
                    <button type="button" id="form-close-button" class="btn btn-secondary">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg> Close
                    </button>
                </div>
            </form>
        </div>
        <div class="form-descriptions">
            <h3>User Type Descriptions</h3>
            <ol>
                <li><strong>SUPER:</strong> Person who have rights of complete ERP software from A to Z. (All Module /
                    All Form)</li>
                <li><strong>ADMIN:</strong> If user type is admin for any particular module, he /she have complete
                    rights on that particular module only . (Assigned Module / All Form)</li>
                <li><strong>USER:</strong> In this type, user can access assign module and its respective functionality.
                    (Assigned Module / Assigned Form)</li>
            </ol>
        </div>
    </main>

    <div id="th-loader-overlay" class="th-loader-overlay" style="display: none;">
        <div class="th-loader-spinner"></div>
    </div>
    <div id="th-change-password-modal" class="th-modal-overlay" style="display: none;">
        <div class="th-modal-content">
            <form id="th-change-password-form">
                <h2>Change Your Password</h2>
                <div class="th-form-group">
                    <label for="th-modal-username">Username</label>
                    <input type="text" id="th-modal-username" name="username" disabled>
                </div>
                <div class="th-form-group">
                    <label for="th-modal-old-password">Old Password</label>
                    <div class="th-password-input-container">
                        <input type="password" id="th-modal-old-password" name="old_password" required>
                        <span class="th-password-toggle-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg></span>
                    </div>
                </div>
                <div class="th-form-group">
                    <label for="th-modal-new-password">New Password</label>
                    <div class="th-password-input-container">
                        <input type="password" id="th-modal-new-password" name="new_password" required>
                        <span class="th-password-toggle-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg></span>
                    </div>
                </div>
                <div class="th-form-group">
                    <label for="th-modal-retype-password">Retype New Password</label>
                    <div class="th-password-input-container">
                        <input type="password" id="th-modal-retype-password" name="retype_password" required>
                        <span class="th-password-toggle-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg></span>
                    </div>
                </div>
                <div class="th-form-actions">
                    <button type="submit" class="th-btn th-btn-success"><svg xmlns="http://www.w3.org/2000/svg"
                            fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg> Save</button>
                    <button type="button" class="th-btn th-btn-secondary" id="th-modal-close-button"><svg
                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg> Close</button>
                </div>
            </form>
        </div>
    </div>
    <div class="th-message-detail-panel" id="th-message-detail-panel">
        <div class="th-message-detail-header">
            <div class="th-message-header-content">
                <div class="th-message-meta-line"><span id="th-message-detail-from"></span><span
                        id="th-message-detail-datetime"></span></div>
                <div class="th-message-meta-line"><span id="th-message-detail-to"></span></div>
                <h3 id="th-message-detail-subject"></h3>
            </div>
            <button class="th-message-detail-close" id="th-message-detail-close-btn">&times;</button>
        </div>
        <div class="th-message-detail-body" id="th-message-detail-body"></div>
    </div>
    <div id="th-contact-directory-modal" class="th-modal-overlay" style="display: none;">
        <div class="th-modal-content"
            style="max-width: 1100px; max-height: 80vh; display: flex; flex-direction: column;">
            <div class="th-contact-modal-header">
                <h2>Contact Directory</h2>
                <button type="button" class="th-btn-close" id="th-contact-dir-close-button">&times;</button>
            </div>
            <div class="contact-table-container">
                <table class="th-contact-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Contact No</th>
                            <th>Email ID</th>
                            <th>Address</th>
                            <th>Remark</th>
                        </tr>
                        <tr class="th-filter-row">
                            <th><input type="text" class="th-column-filter" placeholder="Filter by Name..."
                                    data-column="0"></th>
                            <th><input type="text" class="th-column-filter" placeholder="Filter by Contact..."
                                    data-column="1"></th>
                            <th><input type="text" class="th-column-filter" placeholder="Filter by Email..."
                                    data-column="2"></th>
                            <th><input type="text" class="th-column-filter" placeholder="Filter by Address..."
                                    data-column="3"></th>
                            <th><input type="text" class="th-column-filter" placeholder="Filter by Remark..."
                                    data-column="4"></th>
                        </tr>
                    </thead>
                    <tbody id="th-contact-directory-tbody"></tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="th-theme-change-modal" class="th-modal-overlay" style="display: none;">
        <div class="th-modal-content" style="max-width: 450px;">
            <div class="th-contact-modal-header">
                <h2>Select a Theme</h2>
                <button type="button" class="th-btn-close" id="th-theme-modal-close-button">&times;</button>
            </div>
            <div class="th-theme-list-container" id="th-theme-list-container"></div>
        </div>
    </div>

    <div id="th-status-modal" class="th-modal-overlay" style="display: none;">
        <div class="th-modal-content">
            <div class="th-modal-body">
                <p id="th-status-modal-message"></p>
                <button id="th-status-modal-close">OKAY</button>
            </div>
            <div class="th-modal-footer">
                <span id="th-status-modal-footer-text"></span>
            </div>
        </div>
    </div>
    <footer class="th-site-footer">
        <div class="th-footer-left"><span>Copyright &copy; 2025 ZeroDrift Technologies Pvt. Ltd. All rights
                reserved.</span></div>
        <div class="th-footer-right"><span>To Create Issue: </span><a href="#" target="_blank"
                id="th-issue-management-link">Issue Mng System</a></div>
    </footer>
    <script src="config.js"></script>
    <script src="theme.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Character Counter Logic
            const inputsWithCounter = document.querySelectorAll('#addUserForm .form-input[maxlength]');
            inputsWithCounter.forEach(input => {
                const counter = input.parentElement.querySelector('.char-counter');
                if (counter) {
                    const maxLength = input.getAttribute('maxlength');
                    const updateCounter = () => {
                        counter.textContent = `${input.value.length} / ${maxLength}`;
                    };
                    input.addEventListener('input', updateCounter);
                    updateCounter();
                }
            });

            // Password Toggle Logic
            const passwordInput = document.getElementById('password');
            const passwordToggle = document.getElementById('password-toggle');
            if (passwordInput && passwordToggle) {
                const eyeIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>`;
                const eyeSlashIcon = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243l-4.243-4.243" /></svg>`;
                passwordToggle.innerHTML = eyeIcon;
                passwordToggle.addEventListener('click', function () {
                    if (passwordInput.type === 'password') {
                        passwordInput.type = 'text';
                        passwordToggle.innerHTML = eyeSlashIcon;
                    } else {
                        passwordInput.type = 'password';
                        passwordToggle.innerHTML = eyeIcon;
                    }
                });
            }

            // User Category Logic
            const userCategoryRadios = document.querySelectorAll('input[name="user_category"]');
            const employeeFieldGroup = document.getElementById('employee-name-group');
            function handleCategoryChange() {
                if (!employeeFieldGroup) return;
                const isExternal = document.querySelector('input[name="user_category"]:checked').value === 'External';
                const employeeInput = document.getElementById('employee-select');
                if (isExternal) {
                    employeeFieldGroup.style.display = 'none';
                    employeeInput.required = false;
                } else {
                    employeeFieldGroup.style.display = 'flex';
                    employeeInput.required = true;
                }
            }
            userCategoryRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const selectedCategory = radio.value;
                    document.getElementById('addUserForm').reset();
                    document.querySelector(`input[name="user_category"][value="${selectedCategory}"]`).checked = true;
                    handleCategoryChange();
                });
            });

            // Close Button Logic
            const formCloseButton = document.getElementById('form-close-button');
            if (formCloseButton) {
                formCloseButton.addEventListener('click', () => {
                    window.location.href = 'index.html';
                });
            }

            // Function to populate employees
            async function populateEmployeesDropdown() {
                const datalist = document.getElementById('employee-list');
                if (!datalist) return;
                try {
                    const token = localStorage.getItem('authToken');
                    if (!token) return;
                    const response = await fetch(`${BASE_URL}/api/active-employees`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const employees = await response.json();
                    datalist.innerHTML = '';
                    employees.forEach(employee => {
                        const option = document.createElement('option');
                        option.value = employee.full_name;
                        option.dataset.id = employee.employee_id;
                        datalist.appendChild(option);
                    });
                } catch (error) {
                    console.error('Failed to load employees:', error);
                }
            }

            // ✨ UPDATED showStatusModal function to match the new design ✨
            function showStatusModal(message, type = 'info') { // type can be 'success' or 'error'
                const modal = document.getElementById('th-status-modal');
                const modalMessage = document.getElementById('th-status-modal-message');
                const modalFooterText = document.getElementById('th-status-modal-footer-text');
                const closeButton = document.getElementById('th-status-modal-close');

                modal.classList.remove('success', 'error');

                if (type === 'success') {
                    modal.classList.add('success');
                    modalFooterText.textContent = 'Success';
                } else if (type === 'error') {
                    modal.classList.add('error');
                    modalFooterText.textContent = 'Error';
                } else {
                    modalFooterText.textContent = 'Information';
                }

                modalMessage.textContent = message;
                modal.style.display = 'flex';

                closeButton.onclick = () => {
                    modal.style.display = 'none';
                };
            }

            // ADD USER FORM SUBMISSION LOGIC
            const addUserForm = document.getElementById('addUserForm');
            if (addUserForm) {
                addUserForm.addEventListener('submit', async function (event) {
                    event.preventDefault();
                    const loader = document.getElementById('th-loader-overlay');
                    loader.style.display = 'flex';

                    const formData = new FormData(addUserForm);
                    const data = Object.fromEntries(formData.entries());

                    if (data.user_category === 'Internal') {
                        const employeeName = data.employee.trim();
                        const option = document.querySelector(`#employee-list option[value="${employeeName}"]`);
                        if (option && option.dataset.id) {
                            data.employee_id = option.dataset.id;
                        } else {
                            loader.style.display = 'none';
                            showStatusModal('Invalid Employee Name. Please select a valid employee from the list.', 'error');
                            return;
                        }
                    }

                    try {
                        const token = localStorage.getItem('authToken');
                        const response = await fetch(`${BASE_URL}/api/users`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify(data)
                        });

                        const result = await response.json();
                        loader.style.display = 'none';

                        if (!response.ok) {
                            throw new Error(result.message || 'An unknown error occurred.');
                        }

                        showStatusModal(result.message, 'success');
                        addUserForm.reset();
                        handleCategoryChange();
                        inputsWithCounter.forEach(input => input.dispatchEvent(new Event('input')));

                    } catch (error) {
                        console.error('Failed to create user:', error);
                        loader.style.display = 'none';
                        showStatusModal(error.message, 'error');
                    }
                });
            }

            // Run on page load for initial state
            handleCategoryChange();
            populateEmployeesDropdown();
        });
    </script>
</body>

</html>